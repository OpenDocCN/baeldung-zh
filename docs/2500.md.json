["```\r\n@PersistenceContext\r\nprivate EntityManager entityManager;\r\n```","```\r\n@PersistenceContext(type = PersistenceContextType.EXTENDED)\r\nprivate EntityManager entityManager;\r\n```","```\r\n@Component\r\npublic class TransctionPersistenceContextUserService {\r\n\r\n    @PersistenceContext\r\n    private EntityManager entityManager;\r\n\r\n    @Transactional\r\n    public User insertWithTransaction(User user) {\r\n        entityManager.persist(user);\r\n        return user;\r\n    }\r\n\r\n    public User insertWithoutTransaction(User user) {\r\n        entityManager.persist(user);\r\n        return user;\r\n    }\r\n\r\n    public User find(long id) {\r\n        return entityManager.find(User.class, id);\r\n    }\r\n}\r\n```","```\r\n@Component\r\npublic class ExtendedPersistenceContextUserService {\r\n\r\n    @PersistenceContext(type = PersistenceContextType.EXTENDED)\r\n    private EntityManager entityManager;\r\n\r\n    // Remaining code same as above\r\n}\r\n```","```\r\nUser user = new User(121L, \"Devender\", \"admin\");\r\ntransctionPersistenceContext.insertWithTransaction(user);\r\n\r\nUser userFromTransctionPersistenceContext = transctionPersistenceContext\r\n  .find(user.getId());\r\nassertNotNull(userFromTransctionPersistenceContext);\r\n\r\nUser userFromExtendedPersistenceContext = extendedPersistenceContext\r\n  .find(user.getId());\r\nassertNotNull(userFromExtendedPersistenceContext);\r\n```","```\r\n@Test(expected = TransactionRequiredException.class)\r\npublic void testThatUserSaveWithoutTransactionThrowException() {\r\n    User user = new User(122L, \"Devender\", \"admin\");\r\n    transctionPersistenceContext.insertWithoutTransaction(user);\r\n}\r\n```","```\r\nUser user = new User(123L, \"Devender\", \"admin\");\r\nextendedPersistenceContext.insertWithoutTransaction(user);\r\n\r\nUser userFromExtendedPersistenceContext = extendedPersistenceContext\r\n  .find(user.getId());\r\nassertNotNull(userFromExtendedPersistenceContext);\r\n\r\nUser userFromTransctionPersistenceContext = transctionPersistenceContext\r\n  .find(user.getId());\r\nassertNull(userFromTransctionPersistenceContext);\r\n```","```\r\n@Test(expected = EntityExistsException.class)\r\npublic void testThatPersistUserWithSameIdentifierThrowException() {\r\n    User user1 = new User(126L, \"Devender\", \"admin\");\r\n    User user2 = new User(126L, \"Devender\", \"admin\");\r\n    extendedPersistenceContext.insertWithoutTransaction(user1);\r\n    extendedPersistenceContext.insertWithoutTransaction(user2);\r\n}\r\n```","```\r\njavax.persistence.EntityExistsException: \r\nA different object with the same identifier value\r\nwas already associated with the session\r\n```","```\r\nUser user = new User(127L, \"Devender\", \"admin\");\r\nextendedPersistenceContext.insertWithTransaction(user);\r\n\r\nUser userFromDB = transctionPersistenceContext.find(user.getId());\r\nassertNotNull(userFromDB);\r\n```","```\r\nUser user1 = new User(124L, \"Devender\", \"admin\");\r\nextendedPersistenceContext.insertWithoutTransaction(user1);\r\n\r\nUser user2 = new User(125L, \"Devender\", \"admin\");\r\nextendedPersistenceContext.insertWithTransaction(user2);\r\n\r\nUser user1FromTransctionPersistenceContext = transctionPersistenceContext\r\n  .find(user1.getId());\r\nassertNotNull(user1FromTransctionPersistenceContext);\r\n\r\nUser user2FromTransctionPersistenceContext = transctionPersistenceContext\r\n  .find(user2.getId());\r\nassertNotNull(user2FromTransctionPersistenceContext);\r\n```"]