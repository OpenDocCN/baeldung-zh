# Reddit 应用程序的第三轮改进

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/reddit-web-app-improvements-3>

## **1。概述**

在本文中，我们将通过对现有功能进行小而有用的改进，继续推进我们的小案例研究应用程序。

## **2。更好的桌子**

让我们从使用 jQuery DataTables 插件替换应用程序之前使用的旧的基本表开始。

### **2.1。发布存储库和服务**

首先，我们将添加一个方法来**统计用户**的预定帖子——当然是利用 Spring 数据语法:

[PRE0]

接下来，让我们快速看一下**服务层实现**——基于分页参数检索用户的帖子:

[PRE1]

我们正在根据用户的时区**转换日期:**

[PRE2]

### **2.2。带分页的 API**

接下来，我们将通过 API 发布带有完整分页和排序的操作:

[PRE3]

请注意我们是如何使用自定义头将分页信息传递给客户端的。还有其他稍微标准一点的方法来做这件事，这些方法我们稍后会探讨。

然而，这种实现非常简单——我们有一个简单的方法来生成寻呼信息:

[PRE4]

而`PagingInfo`本身:

[PRE5]

### **2.3。前端**

最后，简单的前端将使用一个定制的 JS 方法与 API 进行交互，并处理 [jQuery 数据表参数](https://web.archive.org/web/20220815042615/https://www.datatables.net/manual/server-side):

[PRE6]

### **2.4。用于分页的 API 测试**

有了现在发布的 API，我们可以编写一些简单的 API 测试来确保分页机制的基本功能按预期工作:

[PRE7]

## **3。电子邮件通知**

接下来，我们将构建一个基本的电子邮件通知流—**,当用户的预定帖子被发送时，用户会收到电子邮件**:

### **3.1。电子邮件配置**

首先，让我们进行电子邮件配置:

[PRE8]

以及使 SMTP 工作的必要属性:

[PRE9]

### **3.2。发布帖子时触发事件**

现在，让我们确保在预定的帖子成功发布到 Reddit 时触发一个事件:

[PRE10]

### **3.3。事件和监听器**

事件实现非常简单:

[PRE11]

而听者:

[PRE12]

## **4。使用帖子总票数**

接下来，我们将做一些工作来简化重新提交选项——而不是处理 upvote 比率(这很难理解)—**它现在处理总票数**。

我们可以使用帖子得分和投票率来计算投票总数:

*   得分=赞成票–反对票
*   总票数=赞成票+反对票
*   赞成票比率=赞成票/总票数

所以:

`Total number of votes = Math.round( score / ((2 * upvote ratio) – 1) )`

首先，我们将修改分数逻辑来计算并跟踪投票总数:

[PRE13]

当然，我们将在**检查一个帖子是否被认为失败时使用它**:

[PRE14]

最后，我们当然会删除旧的`ratio`字段。

## **5。验证重新提交选项**

最后，我们将通过向复杂的重新提交选项添加一些验证来帮助用户:

### **5.1。`ScheduledPost`服务**

下面是简单的`checkIfValidResubmitOptions()`方法:

[PRE15]

在安排新帖子时，我们将充分利用这一验证:

[PRE16]

请注意，如果重新提交逻辑打开，则以下字段需要有非零值:

*   尝试次数
*   时间间隔
*   最低分数要求

### 5.2。异常处理

最后——在输入无效的情况下，在我们的主要错误处理逻辑中处理`InvalidResubmitOptionsException`:

[PRE17]

### 5.3。测试重新提交选项

最后，让我们现在测试我们的重新提交选项–我们将测试激活和停用条件:

[PRE18]

## **6。结论**

在这一期中，我们做了几项改进，即**将案例研究应用程序推向正确的方向**——易用性。

Reddit 日程安排应用程序的整个想法是允许用户通过进入应用程序，完成工作，然后离开，快速地为 Reddit 安排新文章。

它正在到达那里。