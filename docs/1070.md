# 通过 Minikube 使用本地 Docker 图像

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/docker-local-images-minikube>

## **1。概述**

在本教程中，我们将把 Docker 容器部署到 Kubernetes，并看看如何为这些容器使用本地映像。我们将使用 [Minikube](https://web.archive.org/web/20221025150553/https://minikube.sigs.k8s.io/docs/) 来运行 Kubernetes 集群。

## **2。`Dockerfile`**

**首先，我们需要一个`[Dockerfile](https://web.archive.org/web/20221025150553/https://docs.docker.com/engine/reference/builder/)`来创建本地 Docker 图像。**这应该很简单，因为我们将重点关注 Minikube 命令。

让我们创建一个`Dockerfile`,只使用一个`echo`命令来打印一条消息:

[PRE0]

## **3。`docker-env`命令**

对于第一种方法，我们需要确保安装了 [Docker CLI](https://web.archive.org/web/20221025150553/https://docs.docker.com/engine/reference/commandline/cli/) 。这是一个管理 Docker 资源的工具，比如图片和容器。

默认情况下，它使用我们机器上的 Docker 引擎，但是我们可以很容易地改变它。我们将使用它并将我们的 Docker CLI 指向 Minikube 内部的 Docker 引擎。

让我们检查一下这个先决条件，看看 Docker CLI 是否正常工作:

[PRE1]

输出应该如下所示:

[PRE2]

让我们继续下一步。我们可以配置这个 CLI 来使用 Minikube 内部的 Docker 引擎。这样，我们将能够列出 Minikube 中可用的图像，甚至可以在其中构建图像。

让我们看看配置 Docker CLI 所需的[步骤:](https://web.archive.org/web/20221025150553/https://minikube.sigs.k8s.io/docs/commands/docker-env/)

[PRE3]

我们可以在这里看到命令列表:

[PRE4]

**让我们执行最后一行的命令，因为它会为我们进行配置:**

[PRE5]

现在，我们可以使用 Docker CLI 来研究 Minikube 内部的 Docker 环境。

**让我们用 [`minikube image ls`](https://web.archive.org/web/20221025150553/https://minikube.sigs.k8s.io/docs/commands/image/#minikube-image-ls) 命令列出可用的图像:**

[PRE6]

这将打印一个包含图像的表格:

[PRE7]

如果我们将其与 [`docker image ls`](https://web.archive.org/web/20221025150553/https://docs.docker.com/engine/reference/commandline/image_ls/) 命令的输出进行比较，我们会看到两者显示的是相同的列表。这意味着我们的 Docker CLI 配置正确。

让我们用我们的`Dockerfile`和[建立一个图像](https://web.archive.org/web/20221025150553/https://docs.docker.com/engine/reference/commandline/build/):

[PRE8]

现在它在 Minikube 中可用，我们可以创建一个使用此图像的 pod:

[PRE9]

让我们检查一下这个 pod 的日志:

[PRE10]

我们可以看到预期的“Hello World”消息。一切正常。在下一个示例中，让我们关闭终端，确保我们的 Docker CLI 没有连接到 Minikube。

## **4。Minikube 图像加载命令**

让我们看看使用本地图像的另一种方法。这一次，我们将在机器上的 Minikube 外部构建 Docker 映像，并将其加载到 Minikube 中。让我们建立形象:

[PRE11]

现在图像存在了，但在 Minikube 中还不可用。让我们[加载它](https://web.archive.org/web/20221025150553/https://minikube.sigs.k8s.io/docs/commands/image/#minikube-image-load):

[PRE12]

让我们列出图片并检查是否可用:

[PRE13]

我们可以在列表中看到新的图像。这意味着我们可以创建 pod:

[PRE14]

容器成功启动。让我们检查日志:

[PRE15]

我们可以看到它打印了正确的信息。

## **5。Minikube 映像构建命令**

在前面的例子中，我们将一个预构建的 Docker 映像加载到 Minikube。然而，我们也可以在 Minikube 中构建我们的图像。

让我们使用相同的`Dockerfile`并构建一个新的 Docker 映像:

[PRE16]

现在图像在 Minikube 中可用了，我们可以用它启动一个容器:

[PRE17]

让我们检查日志以确保它在工作:

[PRE18]

它按预期打印“Hello World”消息。

## **6。结论**

在本文中，我们使用了三种不同的方式在 Minikube 中运行本地 Docker 映像。

首先，我们将 Docker CLI 配置为连接 Minikube 内部的 Docker 引擎。然后，我们看到了加载一个预构建的映像和直接在 Minikube 中构建一个映像的两个命令。