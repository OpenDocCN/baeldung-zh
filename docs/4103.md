# 保留 Reddit 帖子提交的历史

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/reddit-app-maintain-full-history-of-post-operations>

## **1。概述**

在本期的[Reddit 应用案例研究](/web/20220813070425/https://www.baeldung.com/case-study-a-reddit-app-with-spring)中，我们将开始跟踪**提交帖子**的历史，并使状态更具描述性和易于理解。

## **2。改善`Post`实体**

首先，让我们开始用一个更完整的提交响应列表替换`Post`实体中的旧字符串状态，跟踪更多的信息:

[PRE0]

接下来，让我们看看我们在这个新的提交响应实体中实际跟踪了什么:

[PRE1]

注意，每个**消耗的提交尝试**都有一个`SubmissionResponse`，因此:

*   `attemptNumber`:本次尝试的次数
*   `content`:此次尝试的详细回应
*   `submissionDate`:本次尝试的提交日期
*   `scoreCheckDate`:我们在这次尝试中检查 Reddit `Post`分数的日期

下面是简单的 Spring 数据 JPA 存储库:

[PRE2]

## **3。调度服务**

我们现在需要开始修改服务层来跟踪这些额外的信息。

我们将首先确保我们有一个格式良好的成功或失败原因，来说明帖子被认为是成功还是失败:

[PRE3]

现在，我们将改进旧的逻辑并**跟踪这些额外的历史信息**:

[PRE4]

请注意较低级别的方法实际上在做什么:

*   `addAttemptResponse()`:创建一个新的`SubmissionResponse`记录，并将其添加到帖子中(在每次提交尝试时调用)
*   `updateLastAttemptResponse()`:更新最后一次尝试响应(检查帖子得分时调用)

## **4。预定后 DTO**

接下来，我们将修改 DTO，以确保这些新信息能够公开给客户端:

[PRE5]

这里有一个简单的`SubmissionResponseDto`:

[PRE6]

我们还将在`ScheduledPostRestController`中修改转换方法:

[PRE7]

## **5。前端**

接下来，我们将修改我们的前端`scheduledPosts.jsp`来处理我们的新响应:

[PRE8]

## **6。测试**

最后，我们将对我们的新方法执行一个简单的单元测试:

首先，我们将测试`getSuccessReason()` 的实现:

[PRE9]

接下来，我们将测试`getFailReason()`的实现:

[PRE10]

## **7。结论**

在这一期中，我们介绍了 Reddit 帖子生命周期中一些非常有用的可见性。我们现在可以看到每次提交和删除帖子的确切时间，以及每次操作的确切原因。