["```\r\nCloseableHttpClient client = \r\n  HttpClientBuilder.create().disableRedirectHandling().build();\r\n```","```\r\npublic String expandSingleLevel(String url) throws IOException {\r\n    HttpHead request = null;\r\n    try {\r\n        request = new HttpHead(url);\r\n        HttpResponse httpResponse = client.execute(request);\r\n\r\n        int statusCode = httpResponse.getStatusLine().getStatusCode();\r\n        if (statusCode != 301 && statusCode != 302) {\r\n            return url;\r\n        }\r\n        Header[] headers = httpResponse.getHeaders(HttpHeaders.LOCATION);\r\n        Preconditions.checkState(headers.length == 1);\r\n        String newUrl = headers[0].getValue();\r\n        return newUrl;\r\n    } catch (IllegalArgumentException uriEx) {\r\n        return url;\r\n    } finally {\r\n        if (request != null) {\r\n            request.releaseConnection();\r\n        }\r\n    }\r\n}\r\n```","```\r\n@Test\r\npublic final void givenShortenedOnce_whenUrlIsExpanded_thenCorrectResult() throws IOException {\r\n    final String expectedResult = \"https://www.baeldung.com/rest-versioning\";\r\n    final String actualResult = expandSingleLevel(\"http://bit.ly/3LScTri\");\r\n    assertThat(actualResult, equalTo(expectedResult));\r\n}\r\n```","```\r\npublic String expand(String urlArg) throws IOException {\r\n    String originalUrl = urlArg;\r\n    String newUrl = expandSingleLevel(originalUrl);\r\n    while (!originalUrl.equals(newUrl)) {\r\n        originalUrl = newUrl;\r\n        newUrl = expandSingleLevel(originalUrl);\r\n    }\r\n    return newUrl;\r\n}\r\n```","```\r\n@Test\r\npublic final void givenShortenedMultiple_whenUrlIsExpanded_thenCorrectResult() throws IOException {\r\n    final String expectedResult = \"https://www.baeldung.com/rest-versioning\";\r\n    final String actualResult = expand(\"http://t.co/e4rDDbnzmk\");\r\n    assertThat(actualResult, equalTo(expectedResult));\r\n}\r\n```","```\r\npublic Pair<Integer, String> expandSingleLevelSafe(String url) throws IOException {\r\n```","```\r\npublic String expandSafe(String urlArg) throws IOException {\r\n    String originalUrl = urlArg;\r\n    String newUrl = expandSingleLevelSafe(originalUrl).getRight();\r\n    List<String> alreadyVisited = Lists.newArrayList(originalUrl, newUrl);\r\n    while (!originalUrl.equals(newUrl)) {\r\n        originalUrl = newUrl;\r\n        Pair<Integer, String> statusAndUrl = expandSingleLevelSafe(originalUrl);\r\n        newUrl = statusAndUrl.getRight();\r\n        boolean isRedirect = statusAndUrl.getLeft() == 301 || statusAndUrl.getLeft() == 302;\r\n        if (isRedirect && alreadyVisited.contains(newUrl)) {\r\n            throw new IllegalStateException(\"Likely a redirect loop\");\r\n        }\r\n        alreadyVisited.add(newUrl);\r\n    }\r\n    return newUrl;\r\n}\r\n```"]