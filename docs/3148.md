# Spinnaker 简介

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/ops/spinnaker>

## 1.概观

在本教程中，我们将看看 [Spinnaker](https://web.archive.org/web/20220523154256/https://www.spinnaker.io/) ，一个由网飞构建的开源[连续交付](https://web.archive.org/web/20220523154256/https://continuousdelivery.com/)平台。我们可以使用它在多个云提供商之间部署我们的应用程序。

该系统建立在 Spring Boot T2 的基础上，支持许多云提供商。

我们将看到它是如何工作的，以及在什么情况下我们可以使用它。

## 2.背景

让我们来看看软件开发的历史。首先，我们有不经常发布的瀑布。

在那之后，我们开始敏捷工作，并在每个 sprint 中交付特性。然而，我们仍然没有在每个 sprint 中都部署到生产中。不幸的是，用户仍然无法使用这些被搁置的新功能。

不定期部署有一些原因。其中之一是部署步骤通常是手动执行的，容易出现人为错误。

此外，一些人认为，更频繁地部署意味着潜在问题的风险更大。如今，我们大多数人都同意，部署小的变化意味着犯大错误的风险更小。即使如此，如果有错误，我们也可以在小的改动中快速定位，并发布解决问题的新版本。

## 3.大三角帆

通过 [Spinnaker](https://web.archive.org/web/20220523154256/https://www.spinnaker.io/) ，我们可以使用连续交付或连续部署来自动发布我们的应用程序。连续交付意味着为生产发布做好了一切准备。

但是，在将应用程序部署到生产环境之前，需要手动批准发布。连续部署意味着无需人工干预。所有步骤都已执行，包括生产部署。我们只是将我们的应用程序代码推送到一个版本控制系统，就这样。

从推动我们的代码到版本控制，直到部署到生产，我们可以执行许多步骤。我们可以构建我们的代码，对代码进行单元测试，将其部署在测试环境中，并执行功能测试。我们使用所谓的管道来配置所有这些步骤。

使用 Spinnaker，我们可以创建这样的管道，并在大多数云提供商上部署我们的应用程序。

## 4.成分

Spinnaker 基本上由两部分组成:各种云提供商之上的抽象层和持续交付的工具。

### 4.1.传统云部署

当我们看云提供商时，他们都提供或多或少相同的服务。这些服务包括实例、无服务器和容器支持。

然而，这些服务的配置在提供商之间有很大的不同。这使得在提供商之间切换变得更加困难。转向另一家云提供商并了解所有细节需要一些时间，这意味着我们基本上被供应商锁定在我们的云提供商上。

网飞希望能够在不同的云提供商之间轻松切换，而不是只依赖一家。这就是为什么他们在云提供商之上建立了一个抽象层。

### 4.2.抽象层

当我们使用 Spinnaker 时，它在所有云提供商上都是一样的。我们可以在亚马逊网络服务、微软 Azure、谷歌云平台、OpenStack、谷歌应用引擎或 Kubernetes 上使用它。如果价格更有竞争力，我们就可以转向另一家云提供商。

**此外，我们可以选择同时部署到多个提供商。这样，我们可以在两个或更多的提供者上运行我们的应用程序，以获得额外的冗余。**

抽象层的另一个好处是它关注的是应用而不是资源。通常，云提供商会向我们展示我们当前使用的资源。然而，我们必须弄清楚什么应用程序正在使用什么资源。

但是我们对资源不感兴趣。我们希望运行我们的应用程序，而不需要花费时间跟踪资源。Spinnaker 有一个以应用程序为中心的视图。所以，我们看的时候，首先看到的是应用，然后看到的是应用使用的资源。

### 4.3.连续交货

在抽象层之上，网飞构建了一个持续交付平台。这个平台允许我们在一个或多个云提供商上部署我们的应用。它看起来有点像 Jenkins，但是它提供了与云提供商更好的集成，并且需要更少的配置。

例如，我们可以触发来自 Jenkins 的持续交付管道、上传的 Docker 映像或 git 推送。之后，我们可以简单地用我们的应用程序创建一个图像或容器，并开始生产。

但是，在部署到生产环境之前，还有更多选项可用，例如自动化测试和手动批准。

我们甚至可以决定在部署现有应用程序的新版本时要遵循什么策略。因此，可以简单地用新版本替换旧版本。然而，更好的策略是首先并排运行它们。这样，我们可以自动或手动检查新版本是否工作，如果是，就删除旧版本。

## 5.网飞云模型

每个应用程序都由一个或多个服务器组组成。相同版本的应用程序运行在服务器组中的所有实例上。使用以下命名约定:<应用名称> - <(可选)堆栈> - <(可选细节)> - <版本号>。(可选)stack 字段用于指定服务器组是用于测试、生产还是其他目的。可选的详细信息字段用于附加信息。

最后，我们有一个集群的概念，它包含一个或多个具有相同名称、堆栈和细节的服务器组。然而，大多数时候集群中的每个服务器组运行不同版本的应用程序。失败的实例将被新的实例替换。

还可以自动向服务器组添加实例，以适应增加的负载。

## 6.部署策略

当我们部署新版本的应用程序时，通常会选择“红/黑”策略。首先，将包含应用程序新版本的新服务器组部署到集群。在应用程序部署之后，执行检查以验证新的服务器组是否健康。

现在，服务器组已启用，可供我们的客户使用。最后，旧的服务器组被禁用。

在这种情况下，如果新的应用服务器出现问题，很容易回滚。我们可以简单地再次启用旧版本的服务器组，并将其提供给我们的客户。

## 7.为什么是三角帆

有了 Spinnaker，我们可以专注于我们的应用程序，而不是我们使用的云资源。这使得部署和维护我们的应用程序变得更加容易。

此外，Spinnaker 使同时在多个云提供商上运行成为可能。此外，根据其他云提供商的定价策略和可用功能，我们可以轻松地转向他们。

## 8.结论

**Spinnaker 借鉴了网飞的经验。**我们可以利用他们的知识，以同样的方式轻松工作。基于这些工具，我们可以轻松地实现部署管道，将我们的应用程序部署到生产环境中。

要了解更多关于 Spinnaker 的信息，请下载免费的[连续交付 Spinnaker](https://web.archive.org/web/20220523154256/https://spinnaker.io/docs/concepts/ebook/ContinuousDeliveryWithSpinnaker.pdf) 电子书。