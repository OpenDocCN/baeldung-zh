# 在 Spring 应用程序中通过 CSV 外部化设置数据

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/spring-app-setup-with-csv-files>

## **1。概述**

在本文中，我们将**使用 CSV 文件**将应用程序的设置数据具体化，而不是硬编码。

该设置过程主要涉及在新系统上设置新数据。

## **2。一个 CSV 库**

让我们首先介绍一个简单的用于 CSV 的库——[Jackson CSV 扩展](https://web.archive.org/web/20220627093349/https://github.com/FasterXML/jackson):

[PRE0]

当然，在 Java 生态系统中有许多可用的库来处理 CSV。

我们在这里使用 Jackson 的原因是——Jackson 可能已经在应用程序中使用了，我们读取数据所需的处理相当简单。

## **3。设置数据**

不同的项目需要设置不同的数据。

在本教程中，我们将设置用户数据——基本上是**用一些默认用户**准备系统。

下面是包含用户的简单 CSV 文件:

[PRE1]

注意文件的第一行是如何成为标题行的——列出每一行数据中的字段名称。

## **3。CSV 数据加载器**

让我们首先创建一个简单的数据加载器来**将数据从 CSV 文件读取到工作内存**中。

### **3.1。加载对象列表**

我们将实现`loadObjectList()`功能，从文件中加载特定`Object`的完全参数化列表:

[PRE2]

注意事项:

*   我们基于第一个“标题”行创建了`CSVSchema`。
*   该实现足够通用，可以处理任何类型的对象。
*   如果出现任何错误，将返回一个空列表。

### **3.2。处理多对多关系**

Jackson CSV 不太支持嵌套对象——我们需要使用间接方式加载多对多关系。

我们将把这些**表示为类似于简单的连接表**——因此自然地，我们将从磁盘加载数组列表:

[PRE3]

下面是如何在一个简单的 CSV 文件中表示这些关系之一—`Roles <-> Privileges`:

[PRE4]

注意我们在这个实现中是如何忽略头部的，因为我们并不真正需要那个信息。

## **4。设置数据**

现在，我们将使用一个简单的`Setup` bean 来完成从 CSV 文件设置权限、角色和用户的所有工作:

[PRE5]

### **4.1。设置角色和权限**

首先，让我们将**角色和权限**从磁盘加载到工作内存中，然后将它们作为设置过程的一部分保存下来:

[PRE6]

然后我们将在这里做持久化工作:

[PRE7]

这是我们的`SetupService`:

[PRE8]

请注意，在我们将角色和特权加载到工作内存中之后，我们是如何一个接一个地加载它们的关系的。

### **4.2。设置初始用户**

接下来——让我们将**个用户**加载到内存中，并保存他们:

[PRE9]

接下来，让我们关注持久化用户:

[PRE10]

这是我们的`SetupService`:

[PRE11]

这里是`createSimplePreference()`方法:

[PRE12]

请注意，在我们保存用户之前，我们是如何为它创建一个简单的`Preference`实体并首先持久化它的。

## **5。测试 CSV 数据加载器**

接下来，让我们对我们的`CsvDataLoader`执行一个简单的单元测试:

我们将测试用户、角色和权限列表的加载:

[PRE13]

接下来，让我们通过数据加载器测试加载一些多对多关系:

[PRE14]

## **6。测试设置数据**

最后，让我们对 bean `SetupData`执行一个简单的单元测试:

[PRE15]

## **7。结论**

在这篇简短的文章中，我们探讨了通常需要在启动时加载到系统中的初始数据的另一种设置方法。当然，这只是一个简单的概念证明和一个良好的基础—**而不是一个生产就绪的解决方案**。

我们还将在正在进行的案例研究所跟踪的 Reddit web 应用程序中使用该解决方案。