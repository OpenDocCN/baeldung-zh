# 用 Spring Boot 记录 MongoDB 查询

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/spring-boot-mongodb-logging>

## 1.概观

使用[Spring Data MongoDB](/web/20221009161527/https://www.baeldung.com/spring-data-mongodb-tutorial)时，我们可能需要登录到比默认级别更高的级别。通常，我们可能需要查看一些附加信息，比如语句执行或查询参数。

在这个简短的教程中，我们将看到如何修改查询的 MongoDB 日志级别。

## 2.配置 MongoDB 查询日志记录

[MongoDB 支持](https://web.archive.org/web/20221009161527/https://docs.spring.io/spring-data/mongodb/docs/3.3.1/reference/html/#introduction)提供了 [`MongoOperations`](https://web.archive.org/web/20221009161527/https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/MongoOperations.html) 接口或者它的主 [`MongoTemplate`](https://web.archive.org/web/20221009161527/https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/MongoTemplate.html) 实现来访问数据，所以我们只需要为`MongoTemplate` 类`.`配置一个调试级别

**像任何 Spring 或 Java 应用程序一样，我们可以使用一个[日志库](/web/20221009161527/https://www.baeldung.com/logback)并为`MongoTemplate`** 定义一个日志级别。

通常，我们可以在配置文件中编写如下内容:

[PRE0]

**然而，如果我们正在运行一个 [Spring Boot](/web/20221009161527/https://www.baeldung.com/spring-boot) 应用**，**我们可以在我们的`application.properties`** 文件中进行配置:

[PRE1]

同样，我们可以使用`YAML`语法:

[PRE2]

## 3.日志记录的测试类

首先，让我们创建一个`Book`类:

[PRE3]

我们想要创建一个简单的测试类并检查日志。

为了演示这一点，我们使用了[嵌入式 MongoDB](/web/20221009161527/https://www.baeldung.com/spring-boot-embedded-mongodb) 。为了确保安全，让我们先检查一下我们的依赖关系:

[PRE4]

最后，让我们使用 [Spring Boot 测试](/web/20221009161527/https://www.baeldung.com/spring-boot-testing)来定义我们的测试类:

[PRE5]

## 4.日志样本

在这一节中，我们将定义一些简单的测试用例，并展示相关的日志来测试最常见的场景，比如查找、插入、更新或聚合`Document` s。

### 4.1.插入

首先，让我们从插入单个`Document`开始:

[PRE6]

日志显示了我们正在插入哪个集合。当找到一个`Document`时，id 也被记录:

[PRE7]

### 4.2.更新

同样，当更新一个`Document`时:

[PRE8]

我们可以在日志中看到实际更新的`Document`字段:

[PRE9]

### 4.3.批量插入

让我们添加一个批量插入的示例:

[PRE10]

我们可以在日志中看到插入的`Document`的数量:

[PRE11]

### 4.4.去除

另外，让我们添加一个删除示例:

[PRE12]

我们可以在日志中看到，在本例中，被删除的`Document`的 id:

[PRE13]

### 4.5.聚合

让我们看一个 [`Aggregation`](/web/20221009161527/https://www.baeldung.com/spring-data-mongodb-projections-aggregations) 的例子。在这种情况下，我们需要定义一个结果类。例如，我们将按作者姓名进行聚合:

[PRE14]

接下来，让我们为分组定义一个测试用例:

[PRE15]

我们可以在日志中看到我们聚合了哪个字段以及聚合管道的类型:

[PRE16]

## 5.结论

在本文中，我们研究了如何为 Spring 数据 MongoDB 启用调试日志记录级别。

我们已经定义了一些常见的查询场景，并在进行一些现场测试时查看了它们的相关日志。

和往常一样，这些例子的代码可以在 GitHub 的[上找到。](https://web.archive.org/web/20221009161527/https://github.com/eugenp/tutorials/tree/master/persistence-modules/spring-boot-persistence-mongodb-2)