# 向 Reddit 应用程序添加角色和权限

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/reddit-app-roles-and-privileges>

## **1。概述**

在这一期中，我们将在我们的 Reddit 应用程序中引入简单的角色和权限，然后能够做一些有趣的事情，例如——限制普通用户每天可以在 Reddit 上发布多少帖子。

由于我们将有一个管理员角色，也就是管理员用户，我们还将添加一个管理员管理区域。

## **2。`User`、`Role`和`Privilege`实体**

首先，我们将修改`User`实体——我们通过我们的 [Reddit 应用程序系列](/web/20210917093839/https://www.baeldung.com/case-study-a-reddit-app-with-spring)使用它——来添加角色:

[PRE0]

请注意用户-角色关系是一种灵活的多对多关系。

接下来，我们将定义`Role`和`Privilege`实体。有关该实现的全部细节，请查看[关于 Baeldung](/web/20210917093839/https://www.baeldung.com/role-and-privilege-for-spring-security-registration) 的这篇文章。

## **3。设置**

接下来，我们将在项目引导上运行一些基本设置，以创建这些角色和权限:

[PRE1]

并让我们的测试用户成为管理员:

[PRE2]

## **4。注册标准用户**

我们还需要确保我们通过`registerNewUser()`实现注册了标准用户:

[PRE3]

请注意，系统中的角色包括:

1.  对于普通用户(默认角色)——他们有一天可以安排多少帖子的限制
2.  `ROLE_SUPER_USER`:无调度限制
3.  `ROLE_ADMIN`:附加管理选项

## **5。本金**

接下来，让我们将这些新特权集成到我们的主要实现中:

[PRE4]

## **6。限制标准用户的预定帖子**

现在，让我们利用新的角色和权限，**限制标准用户每天安排的新文章不超过 3 篇**，以避免向 Reddit 发送垃圾邮件。

### **6.1。发布存储库**

首先，我们将在我们的`PostRepository`实现中添加一个新操作——统计特定用户在特定时间段内的预定帖子:

[PRE5]

### 5.2。预定后控制器

然后，我们将向`schedule()`和`updatePost()`方法添加一个简单的检查:

[PRE6]

这里发生了一些有趣的事情。首先——注意我们如何手动与 Spring Security 交互，并检查当前登录的用户是否有特权。这不是你每天都要做的事情，但是当你不得不做的时候，这个 API 非常有用。

按照目前的逻辑——如果用户有`POST_UNLIMITED_PRIVILEGE`——他们能够——惊喜地——安排他们想安排的时间。

然而，如果他们没有这种特权，他们每天最多只能排 3 个帖子。

## **7。管理员用户页面**

接下来——现在我们已经根据用户的角色对他们进行了明确的划分——让我们为小型 Reddit 应用的管理员实现一些非常简单的用户管理。

### 7.1。显示所有用户

首先，让我们创建一个列出系统中所有用户的基本页面:

这里列出所有用户的 API:

[PRE7]

和服务层实现:

[PRE8]

然后，简单的前端:

[PRE9]

### 7.2。修改用户的角色

接下来，一些简单的逻辑来管理这些用户的角色；让我们从控制器开始:

[PRE10]

服务层:

[PRE11]

最后，简单的前端:

[PRE12]

## **8。安全配置**

最后，我们需要修改安全配置，将管理员用户重定向到系统中这个新的独立页面:

[PRE13]

我们使用一个定制的身份验证成功处理程序来**决定用户登录**后的位置:

[PRE14]

以及极其简单的管理主页`adminHome.html`:

[PRE15]

## **9。结论**

在案例研究的这个新部分中，我们在应用程序中添加了一些简单的安全构件——角色和权限。在这种支持下，**我们构建了两个简单的特性**——标准用户的调度限制和管理用户的基本管理。