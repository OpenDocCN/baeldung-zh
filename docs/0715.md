# Apache Commons DbUtils 指南

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/apache-commons-dbutils>

## **1。概述**

Apache Commons DbUtils 是一个小型的库，它使得使用 JDBC 更加容易。

在本文中，我们将实现一些示例来展示它的特性和功能。

## **2。设置**

### **2.1。Maven 依赖关系**

首先，我们需要将`commons-dbutils`和`h2`依赖项添加到我们的`pom.xml`中:

[PRE0]

你可以在 Maven Central 上找到最新版本的 [commons-dbutils](https://web.archive.org/web/20220628154500/https://search.maven.org/classic/#search%7Cgav%7C1%7Cg%3A%22commons-dbutils%22%20AND%20a%3A%22commons-dbutils%22) 和 [h2](https://web.archive.org/web/20220628154500/https://search.maven.org/classic/#search%7Cgav%7C1%7Cg%3A%22com.h2database%22%20AND%20a%3A%22h2%22) 。

### **2.2。测试数据库**

有了依赖项之后，让我们创建一个脚本来创建我们将使用的表和记录:

[PRE1]

本文中的所有示例测试用例都将使用一个新创建的到 H2 内存数据库的连接:

[PRE2]

### **2.3。波霍斯**

最后，我们需要两个简单的类:

[PRE3]

## **3。简介**

DbUtils 库提供了**`QueryRunner`类作为大多数可用功能的主要入口点**。

该类通过接收到数据库的连接、要执行的 SQL 语句以及为查询的占位符提供值的可选参数列表来工作。

正如我们将在后面看到的，一些方法也接收了一个`ResultSetHandler`实现——它负责将`ResultSet`实例转换成我们的应用程序期望的对象。

当然，这个库已经提供了几个处理最常见转换的实现，比如列表、映射和 JavaBeans。

## **4。查询数据**

现在我们知道了基本知识，我们准备查询我们的数据库。

让我们从一个简单的例子开始，用一个`MapListHandler`获得数据库中的所有记录，作为一个地图列表:

[PRE4]

接下来，下面是一个使用`BeanListHandler`将结果转换成`Employee`实例的例子:

[PRE5]

对于返回单个值的查询，我们可以使用`ScalarHandler`:

[PRE6]

要了解所有的`ResultSerHandler`实现，可以参考 [`ResultSetHandler`文档](https://web.archive.org/web/20220628154500/https://commons.apache.org/proper/commons-dbutils/apidocs/org/apache/commons/dbutils/ResultSetHandler.html)。

### **4.1。自定义处理程序**

当我们需要更多地控制结果如何被转换成对象时，我们也可以创建一个自定义的处理程序来传递给`QueryRunner`的方法。

这可以通过实现`ResultSetHandler`接口或者扩展库提供的一个现有实现来实现。

让我们看看第二种方法是什么样子的。首先，让我们向我们的`Employee`类添加另一个字段:

[PRE7]

现在，让我们创建一个扩展`BeanListHandler`类型的类，并为每个雇员设置电子邮件列表:

[PRE8]

注意，我们在构造函数中期待一个`Connection`对象，这样我们就可以执行查询来获取电子邮件。

最后，让我们测试我们的代码，看看是否一切都按预期运行:

[PRE9]

### **4.2。定制行处理器**

在我们的例子中，`employee`表的列名与我们的`Employee`类的字段名匹配(匹配不区分大小写)。然而，情况并不总是如此——例如，当列名使用下划线来分隔复合词时。

在这些情况下，我们可以利用`RowProcessor`接口及其实现将列名映射到我们的类中适当的字段。

让我们看看这个是什么样子的。首先，让我们创建另一个表，并在其中插入一些记录:

[PRE10]

现在，让我们修改我们的`EmployeeHandler`类:

[PRE11]

注意，我们使用了一个`BeanProcessor`来完成列到字段的实际映射，并且只针对那些需要被寻址的字段。

最后，让我们测试一切正常:

[PRE12]

## **5。插入记录**

`QueryRunner`类提供了两种在数据库中创建记录的方法。

第一种方法是使用`update()`方法，并传递 SQL 语句和可选的替换参数列表。方法返回插入的记录数:

[PRE13]

第二种方法是使用`insert()`方法，除了 SQL 语句和替换参数，还需要一个`ResultSetHandler`来转换生成的自动生成的键。返回值将是处理程序返回的内容:

[PRE14]

## **6。更新和删除**

`QueryRunner`类的`update()`方法也可以用来修改和删除数据库中的记录。

它的用法很简单。以下是如何更新员工工资的示例:

[PRE15]

下面是另一个删除给定 id 的雇员的例子:

[PRE16]

## **7。异步操作**

DbUtils 提供了`AsyncQueryRunner`类来异步执行操作。这个类的方法与`QueryRunner`类的方法有对应关系，除了它们返回一个`Future`实例。

下面是一个获取数据库中所有雇员的示例，等待 10 秒钟即可得到结果:

[PRE17]

## **8。结论**

在本教程中，我们探索了 Apache Commons DbUtils 库最显著的特性。

我们查询数据并将其转换为不同的对象类型，插入记录以获得生成的主键，并根据给定的标准更新和删除数据。我们还利用了`AsyncQueryRunner`类来异步执行查询操作。

和往常一样，本文的完整源代码可以在 Github 上找到[。](https://web.archive.org/web/20220628154500/https://github.com/eugenp/tutorials/tree/master/libraries-apache-commons)