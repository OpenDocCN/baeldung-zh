# Hibernate @WhereJoinTable 注释

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/hibernate-wherejointable>

## 1.概观

使用像 Hibernate 这样的对象关系映射工具，可以很容易地将数据读入对象，但是对于复杂的数据模型，却很难形成查询。

多对多的关系总是具有挑战性，但是当我们希望**基于关系本身的一些属性来获取相关的实体时，这可能更具挑战性。**

在本教程中，我们将看看如何使用 Hibernate 的`@WhereJoinTable`注释来解决这个问题。

## 2.基本`@ManyToMany`关系

让我们从一个简单的 [`@ManyToMany`关系](/web/20221128035425/https://www.baeldung.com/jpa-many-to-many)开始。我们需要领域模型实体、关系实体和一些样本测试数据。

### 2.1.领域模型

假设我们有两个简单的实体，`User`和`Group`，它们被关联为`@ManyToMany:`

[PRE0]

[PRE1]

正如我们所看到的，我们的`User`实体可以是多个`Group`实体的成员。类似地，一个`Group`实体可以包含不止一个`User`实体。

### 2.2.关系实体

**对于`@ManyToMany`关联，我们需要一个单独的数据库表，称为关系表。**关系表需要包含至少两列:相关的`User`和`Group`实体的主键。

只有两个主键列[，我们的 Hibernate 映射可以表示这个关系表](/web/20221128035425/https://www.baeldung.com/hibernate-many-to-many)。

但是，如果我们需要在关系表中放入额外的数据，**我们还应该为多对多关系本身定义一个关系实体。**

让我们创建`UserGroupRelation`类来做这件事:

[PRE2]

这里我们将实体命名为`r_user_group`,这样我们可以在以后引用它。

对于我们的额外数据，假设我们想要为每个`Group`存储每个`User`的角色。所以，我们将创建`UserGroupRole`枚举:

[PRE3]

接下来，我们将向`UserGroupRelation:`添加一个`role`属性

[PRE4]

最后，为了正确配置它，我们需要在`User`的`groups`集合上添加`@JoinTable`注释。这里我们将使用`UserGroupRelation:`的实体名`r_user_group,` 来指定连接表名

[PRE5]

### 2.3.抽样资料

对于我们的集成测试，让我们定义一些样本数据:

[PRE6]

我们可以看到，`user1`和`user2`分两组。另外，我们应该注意到，`user1`在`group1`上是`MODERATOR`，同时它在`group2`上有一个`MEMBER`角色。

## 3.获取`@ManyToMany`关系

现在我们已经正确地配置了我们的实体，让我们获取`User`实体的组。

### 3.1.简单获取

为了获取组，我们可以简单地调用活动 Hibernate 会话中的`User`的`getGroups()`方法:

[PRE7]

我们对`groups`的输出将是:

[PRE8]

但是，我们如何获得组角色仅为`MODERATOR?`的用户的组呢

### 3.2.关系实体上的自定义筛选器

我们可以**使用`@WhereJoinTable`注释直接只获取过滤后的组。**

让我们定义一个新的属性为`moderatorGroups`，并在上面加上`@WhereJoinTable`注释。当我们通过该属性访问相关实体时，它将只包含我们的用户是`MODERATOR.`的组

我们需要添加一个 SQL where 子句来根据`MODERATOR` 角色过滤组:

[PRE9]

因此，我们可以很容易地获得应用了指定 SQL where 子句的组:

[PRE10]

我们的输出将是用户仅拥有`MODERATOR:`角色的组

[PRE11]

## 4.结论

在本教程中，我们学习了如何使用 Hibernate 的`@WhereJoinTable`注释基于关系表的属性**过滤`@ManyToMany`集合。**

和往常一样，本教程中给出的所有代码示例都可以从 GitHub 上的[处获得。](https://web.archive.org/web/20221128035425/https://github.com/eugenp/tutorials/tree/master/persistence-modules/hibernate-annotations)