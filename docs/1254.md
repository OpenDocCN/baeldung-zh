# 从 Docker 引擎 API 获取 Docker 容器

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/ops/docker-engine-api-container-info>

## 1.概观

在本教程中，我们将看到如何使用 Docker 引擎 API 从容器内部访问 Docker 容器信息。

## 2.设置

我们可以通过多种方式连接 Docker 引擎。我们将讨论 Linux 下最有用的，但是它们也适用于其他操作系统。

然而，我们应该**非常小心**、**，因为启用远程访问会带来安全风险**。当容器可以访问引擎时，**它打破了与主机操作系统的隔离**。

对于设置部分，我们将考虑我们对主机的完全控制。

### 2.1.转发默认的 Unix 套接字

默认情况下，Docker 引擎使用安装在主机操作系统上的`/var/run/docker.sock`下的 Unix 套接字:

[PRE0]

使用这种方法，我们可以严格控制哪个容器可以访问 API。这就是 Docker CLI 在幕后的工作方式。

让我们启动`alpine` Docker 容器，**使用`-v` 标志**挂载这个路径:

[PRE1]

接下来，让我们在容器中安装一些实用程序:

[PRE2]

现在让**使用带有`–unix-socket` 标志的`curl`** 和 [`Jq`](/web/20220727020703/https://www.baeldung.com/linux/jq-command-json) 来获取和过滤一些容器数据:

[PRE3]

这里，**我们在`/containers/json`** 端点上发出一个`GET` ，**得到当前运行的容器**。然后我们使用`jq`美化输出。

稍后我们将讨论引擎 API 的细节。

### 2.2.启用 TCP 远程访问

我们还可以使用 TCP 套接字实现远程访问。

对于带有`systemd`的 Linux 发行版，我们需要定制 Docker 服务单元。对于其他 Linux 发行版，我们需要定制通常位于`/etc/docker`的`daemon.json`。

我们将只讨论第一种设置，因为大多数步骤都是相似的。

默认 Docker 设置包括一个桥接网络。这里是**，所有的集装箱都在这里连接，除非另有说明**。

因为我们希望只允许容器访问引擎 API，所以让我们首先确定它们的网络:

[PRE4]

让我们来看看它的细节:

[PRE5]

接下来，让我们看看 Docker 服务单元位于何处:

[PRE6]

现在让我们来看看服务单元的定义:

[PRE7]

属性定义了由`systemd`(`dockerd`可执行文件)运行的命令。**我们将`-H` 标志传递给它，并指定相应的网络和端口在**上监听。

我们可以直接修改这个服务单元(不推荐)，但是让我们使用`$DOCKER_OPTS` 变量(在`EnvironmentFile=/etc/sysconfig/docker`中定义):

[PRE8]

这里，**我们使用桥接网络的网关地址作为绑定地址**。**这对应于主机**上的`docker0`界面:

[PRE9]

我们还启用了本地 Unix 套接字，以便 Docker CLI 仍然可以在主机上工作。

我们还需要做一步。让我们**允许我们的容器包到达主机**:

[PRE10]

这里，我们设置 Linux 防火墙接受所有通过`docker0`接口的包。

现在，让我们重新启动 Docker 服务:

[PRE11]

让我们再次运行我们的`alpine` 容器:

[PRE12]

我们应该**意识到所有连接到桥接网络的容器都可以访问守护程序 API** 。

此外，**我们的 TCP 连接没有加密**。

## 3.坞站引擎 API

现在我们已经设置了远程访问，让我们来看看 API。

我们将只探索几个有趣的选项，但我们可以随时查看[完整文档](https://web.archive.org/web/20220727020703/https://docs.docker.com/engine/api/latest)了解更多信息。

让我们**获取一些关于我们的容器**的信息:

[PRE13]

在这里**我们使用`/containers/{container-id}/json`** URL 来获取关于我们容器的详细信息。

在这种情况下，我们运行`hostname`命令来获取`container-id`。

接下来，让我们**监听 Docker 守护进程**上的事件:

[PRE14]

现在，在另一个终端中，让我们启动`hello-world` 容器:

[PRE15]

回到我们的`alpine` 容器，我们得到一系列事件:

[PRE16]

到目前为止，我们一直在做非侵入性的事情。是时候改变一下了。

让我们创建并启动一个容器。首先，我们定义它的清单:

[PRE17]

现在让**使用清单**调用`/containers/create`端点:

[PRE18]

然后，我们使用 id 来启动容器:

[PRE19]

最后，我们可以浏览日志:

[PRE20]

注意我们在每一行的开头都有一些奇怪的字符。这是因为传输日志的流被[复用](https://web.archive.org/web/20220727020703/https://docs.docker.com/engine/api/v1.40/#operation/ContainerAttach)以区分`stderr` 和`stdout`。

因此，输出需要进一步处理。

我们可以通过在创建容器时启用`TTY`选项来避免这种情况:

[PRE21]

## 4.结论

在本教程中，我们学习了如何使用 Docker 引擎远程 API。

我们从设置来自 UNIX 套接字或 TCP 的远程访问开始，并进一步展示了如何使用远程 API。