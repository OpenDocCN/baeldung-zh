["```\r\nistioctl install --set profile=demo -y\r\n```","```\r\nkubectl label namespace default istio-injection=enabled\r\n```","```\r\napiVersion: apps/v1beta1\r\nkind: Deployment\r\nmetadata:\r\n  name: order-service\r\n  namespace: default\r\nspec:\r\n  replicas: 1\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: order-service\r\n        version: v1\r\n    spec:\r\n      containers:\r\n      - name: order-service\r\n        image: kchandrakant/order-service:v1\r\n        resources:\r\n          requests:\r\n            cpu: 0.1\r\n            memory: 200\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: order-service\r\nspec:\r\n  ports:\r\n  - port: 80\r\n    targetPort: 80\r\n    protocol: TCP\r\n    name: http\r\n  selector:\r\n    app: order-service\r\n```","```\r\nkubectl apply -f booking-service.yaml -f inventory-service.yaml -f shipping-service.yaml\r\n```","```\r\napiVersion: networking.istio.io/v1alpha3\r\nkind: Gateway\r\nmetadata:\r\n  name: booking-gateway\r\nspec:\r\n  selector:\r\n    istio: ingressgateway\r\n  servers:\r\n  - port:\r\n      number: 80\r\n      name: http\r\n      protocol: HTTP\r\n    hosts:\r\n    - \"*\"\r\n---\r\napiVersion: networking.istio.io/v1alpha3\r\nkind: VirtualService\r\nmetadata:\r\n  name: booking\r\nspec:\r\n  hosts:\r\n  - \"*\"\r\n  gateways:\r\n  - booking-gateway\r\n  http:\r\n  - match:\r\n    - uri:\r\n        prefix: /api/v1/booking\r\n    route:\r\n    - destination:\r\n        host: booking-service\r\n        port:\r\n          number: 8080\r\n```","```\r\napiVersion: networking.istio.io/v1alpha3\r\nkind: VirtualService\r\nmetadata:\r\n  name: shipping-service\r\nspec:\r\n  hosts:\r\n    - shipping-service\r\n  http:\r\n  - route:\r\n    - destination:\r\n        host: shipping-service\r\n        subset: v1\r\n      weight: 90\r\n    - destination:\r\n        host: shipping-service\r\n        subset: v2\r\n      weight: 10\r\n---\r\napiVersion: networking.istio.io/v1alpha3\r\nkind: DestinationRule\r\nmetadata:\r\n  name: shipping-service\r\nspec:\r\n  host: shipping-service\r\n  subsets:\r\n  - name: v1\r\n    labels:\r\n      version: v1\r\n  - name: v2\r\n    labels:\r\n      version: v2\r\n```","```\r\napiVersion: networking.istio.io/v1alpha3\r\nkind: DestinationRule\r\nmetadata:\r\n  name: inventory-service\r\nspec:\r\n  host: inventory-service\r\n  trafficPolicy:\r\n    connectionPool:\r\n      tcp:\r\n        maxConnections: 1\r\n      http:\r\n        http1MaxPendingRequests: 1\r\n        maxRequestsPerConnection: 1\r\n    outlierDetection:\r\n      consecutive5xxErrors: 1\r\n      interval: 1s\r\n      baseEjectionTime: 3m\r\n      maxEjectionPercent: 100\r\n```","```\r\napiVersion: \"security.istio.io/v1beta1\"\r\nkind: \"PeerAuthentication\"\r\nmetadata:\r\n  name: \"default\"\r\n  namespace: \"istio-system\"\r\nspec:\r\n  mtls:\r\n    mode: STRICT\r\n```","```\r\napiVersion: security.istio.io/v1beta1\r\nkind: AuthorizationPolicy\r\nmetadata:\r\n  name: require-jwt\r\n  namespace: default\r\nspec:\r\n  selector:\r\n    matchLabels:\r\n      app: booking-service\r\n  action: ALLOW\r\n  rules:\r\n  - from:\r\n    - source:\r\n       requestPrincipals: [\"[[email protected]](/web/20221029013823/https://www.baeldung.com/cdn-cgi/l/email-protection)/[[email protected]](/web/20221029013823/https://www.baeldung.com/cdn-cgi/l/email-protection)\"]\r\n```"]