# Gradle 构建缓存基础

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/gradle-build-cache>

## 1.概观

构建缓存可以使代码构建过程更快，从而提高开发人员的生产力。在本文中，我们将了解 Gradle 构建缓存的基础知识`.`

## 2.什么是 Gradle 构建缓存？

Gradle 构建缓存是保存构建任务输出的半永久性存储。它支持重用先前构建中已经生成的工件。Gradle 构建缓存背后的指导原则是，如果输入没有改变，它应该避免重新构建已经构建的任务。通过这种方式，完成后续构建的时间减少了。

在 Gradle 中，一个构建缓存键唯一地标识一个工件或一个任务输出。在执行任务之前，Gradle 通过散列任务的每个输入来计算缓存键。然后，它查看远程或本地缓存，检查与计算的缓存键对应的任务输出是否已经存在。如果不存在，则执行该任务。否则，Gradle 将重用现有的任务输出。

现在，让我们来看看两种不同的 Gradle 构建缓存。

### 2.1.本地生成缓存

本地生成缓存使用系统目录来存储任务输出。**默认位置是指向`$USER_HOME/.gradle/caches`** 的 Gradle 用户主目录。每次我们在系统中运行构建时，工件都会存储在这里。默认情况下，它是启用的，其位置是可配置的。

### 2.2.远程构建缓存

远程缓存是共享的构建缓存。对远程缓存的读写是通过 HTTP 完成的。远程缓存最常见的用例之一是持续集成构建。在每次全新构建时，CI 服务器都会填充远程缓存。因此，被更改的组件将不会被重新构建，从而加快了 CI 构建的速度。此外，任务输出也可以在 CI 代理之间共享。**远程缓存默认不启用。**

当远程和本地缓存都启用时，构建输出首先在本地缓存中检查。如果输出不在本地缓存中，它将从远程缓存中下载并存储在本地缓存中。然后，在下一次构建中，从本地缓存中取出相同的任务输出，以加速构建过程。

## 3.配置梯度构建缓存

**我们可以通过提供** **`settings.gradle`文件**中的`Settings.build-cache` 块来配置缓存。这里，我们使用 [Groovy 闭包](/web/20220929050903/https://www.baeldung.com/groovy-closures#:~:text=A%20closure%20is%20an%20anonymous,its%20local%20variables%20%E2%80%94%20during%20execution.)来编写配置。让我们看看如何配置不同类型的缓存。

### 3.1.配置本地生成缓存

让我们在`settings.gradle`文件中添加本地构建缓存配置:

```
buildCache {
    local {
        directory = new File(rootDir, 'build-cache')
        removeUnusedEntriesAfterDays = 30
    }
} 
```

在上面的代码块中，`directory `对象代表存储构建输出的位置。这里，`rootDir` 变量代表项目的根目录。我们也可以改变`directory` 对象指向另一个位置。

**为了节省空间，本地构建缓存还会定期删除在指定时间段内没有使用的条目。**属性`removeUnusedEntriesAfterDays `用于配置天数，在此之后，未使用的工件将从本地缓存中移除。其默认值为七天。

**我们也可以通过从`$USER_HOME/.gradle/caches` 文件夹中删除条目来手动清理。**在 Linux 系统上，我们可以使用`rm `命令来清理目录:

```
rm -r $HOME/.gradle/caches
```

我们还可以配置一些附加属性。例如，`enabled `是一个布尔属性，表示本地缓存是否启用。**如果`push `属性被设置为`true`，构建输出将被存储在缓存中。默认情况下，本地构建缓存的值是`true`。**

### 3.2.配置远程缓存

让我们在`settings.gradle `文件中添加`buildCache `块来配置远程缓存。

对于远程缓存，我们需要以 URL 的形式提供位置以及访问它的`username`和`password`:

```
buildCache {
    remote(HttpBuildCache) {
        url = 'https://example.com:8123/cache/'
        credentials {
            username = 'build-cache-user-name'
            password = 'build-cache-password'
        }
    }
}
```

## 4.使用**梯度构建缓存**的优势

现在让我们来看看使用 Gradle build cache 的一些好处:

*   它可以通过减少构建时间来提高开发人员的生产力。
*   因为如果输入不变，任务输出将被重用，所以在版本控制分支之间来回切换时，它还有助于减少构建时间。
*   使用远程缓存可以显著减少 CI 代理生成构建所需的工作量。这也减少了 CI 构建所需的基础设施。
*   减少 CI 机器上的网络使用，因为来自远程缓存的结果将存储在本地缓存中。
*   远程缓存可以帮助开发人员共享结果。这消除了在本地重新构建由从事同一项目的其他开发人员所做的更改的需要。
*   远程缓存还可以支持在 CI 代理之间共享构建。
*   随着构建时间的减少，这导致了更快的反馈周期。因此，构建将会更频繁地生成。因此，这可以提高软件的质量。

## 5.结论

在本文中，我们了解了 Gradle 构建缓存以及它如何加速构建过程。我们还探讨了它的不同类型及其配置。最后，我们讨论了 Gradle 构建缓存的好处。