# 一个 Java VM 可以支持多少个线程？

> 原文:[https://web . archive . org/web/20220930061024/https://www . bael dung . com/JVM-max-threads](https://web.archive.org/web/20220930061024/https://www.baeldung.com/jvm-max-threads)

## 1.概观

这些年来，我们使用的系统的性能呈指数级增长。因此，Java VM 支持的线程数量也增加了。

但是，我们实际上能创造多少呢？答案不是一个确切的数字，因为它取决于许多因素。

我们将讨论其中的几个因素，以及它们如何影响我们可以在 Java VM 中创建的线程数量。

## 2.栈存储器

线程最重要的组成部分之一是它的堆栈。我们创建的最大堆栈大小和线程数量与可用的系统内存量直接相关。

因此，增加内存容量也增加了我们可以在系统上运行的最大线程数量。关于堆栈大小的更多细节可以在我们的文章[在 JVM 中配置堆栈大小](/web/20220716081743/https://www.baeldung.com/jvm-configure-stack-sizes)中找到。

最后，值得一提的是，从 Java 11 开始，JVM 不再积极地为一个堆栈提交所有的保留内存。这有助于增加我们可以运行的线程数量。换句话说，即使我们增加了最大堆栈大小，线程使用的内存量也将基于实际的堆栈大小。

## 3.堆内存

堆不会直接影响我们可以执行的线程数量。但是，它也使用相同的系统内存。

因此，**增加堆的大小会限制栈**的可用内存，从而减少我们可以创建的最大线程数。

## 4.操作系统选择

创建新的 Java 线程时，会创建一个新的本机操作系统线程，并直接链接到来自虚拟机的线程。

因此，操作系统控制着线程的管理。

此外，基于操作系统的类型，可以应用各种限制。

在下面的小节中，我们将讨论最常见系统的这些方面。

### 4.1.Linux 操作系统

基于 Linux 的系统，在[内核](/web/20220716081743/https://www.baeldung.com/cs/os-kernel)级别，将线程视为进程。因此，像`**pid_max**`内核参数这样的进程限制将直接影响我们可以创建的线程数量。

另一个内核参数是 **`threads-max`** ，它描述了线程的整体最大数量。

我们可以通过执行`**sysctl kernel.<parameter-name>**`来检索所有这些参数。

最后，还有每个用户的最大进程数的限制，可以使用 **`ulimit -u`** 命令获取。

### 4.2.Windows 操作系统

在 Windows 机器上，对线程没有限制。因此，我们可以创建尽可能多的线程，直到我们的系统用完可用的系统内存。

### 4.3.马科斯

运行 macOS 的系统有两个主要限制，由两个内核参数定义:

*   **`num_threads`** 表示可以创建的线程总数的最大值
*   `**num_taskthreads**`表示每个进程的最大线程数

这些参数的值可以通过执行 **`sysctl kern.`** <参数名>来访问。

值得一提的一点是，当达到这些限制之一时，会抛出一个`OutOfMemoryError `，这可能会产生误导。

## 5.虚拟线程

我们可以通过利用 Project Loom 附带的[轻量级虚拟线程来进一步增加我们可以创建的线程数量，Project Loom](/web/20220716081743/https://www.baeldung.com/java-virtual-thread-vs-thread)尚未公开提供。

虚拟线程是由 JVM 创建的，**不使用 OS 线程**，这意味着我们可以同时创建数百万个线程。

## 6.结论

在本文中，我们研究了可能影响 Java 虚拟机中可以创建的最大线程数的最重要方面。

但是，在大多数情况下，增加限制不太可能永久解决可伸缩性问题。我们需要重新考虑应用程序的实现，甚至应用水平扩展。