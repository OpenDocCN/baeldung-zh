# 使用 Spring 数据的 Spring Boot 应用程序中的 DynamoDB

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/spring-data-dynamodb>

## **1。概述**

在本文中，**我们将通过一个实际的示例项目来探索将 DynamoDB 集成到 Spring Boot 应用程序中的基础知识。**

我们将演示如何使用 Spring 数据配置应用程序来使用本地 DynamoDB 实例。我们还将创建一个示例数据模型和存储库类，并使用集成测试执行实际的数据库操作。

## **2。DynamoDB**

DynamoDB 是 AWS 上完全托管的 NoSQL 数据库，类似于 Cassandra 或 MongoDB 等其他 NoSQL 数据库。DynamoDB 提供了快速、一致和可预测的性能，并且可大规模扩展。

你可以在 AWS 文档上了解更多关于 DynamoDB 的信息。

让我们安装一个 DynamoDB 的本地实例**,以避免产生运行一个活动实例的成本。**

对于开发来说，在本地运行 DynamoDB 比在 AWS 上运行更有意义；本地实例将作为可执行的 JAR 文件运行。

你可以在这里找到关于如何在本地运行 DynamoDB 的说明。

## **3。Maven 依赖关系**

添加以下依赖项，开始使用 Spring 数据使用 DynamoDB:

*   [春季数据 JPA](https://web.archive.org/web/20220703151853/https://search.maven.org/classic/#search%7Cga%7C1%7Cg%3A%22org.springframework.data%22%20AND%20a%3A%22spring-data-releasetrain%22)
*   [AWS Java SDK DynamoDB](https://web.archive.org/web/20220703151853/https://search.maven.org/classic/#search%7Cga%7C1%7Cg%3A%22com.amazonaws%22%20AND%20a%3A%22aws-java-sdk-dynamodb%22)
*   [Spring Data DynamoDB 社区模块](https://web.archive.org/web/20220703151853/https://search.maven.org/classic/#search%7Cga%7C1%7Cg%3A%22com.github.derjust%22%20AND%20a%3A%22spring-data-dynamodb%22)

```
<dependencyManagement>
    <dependencies>
    <dependency>
        <groupId>org.springframework.data</groupId>
        <artifactId>spring-data-releasetrain</artifactId>
        <version>Lovelace-SR16</version>
        <type>pom</type>
        <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
<dependencies>
    <dependency>
        <groupId>com.amazonaws</groupId>
        <artifactId>aws-java-sdk-dynamodb</artifactId>
        <version>1.11.64</version>
    </dependency>
    <dependency>
        <groupId>com.github.derjust</groupId>
        <artifactId>spring-data-dynamodb</artifactId>
        <version>5.1.0</version>
    </dependency>
</dependencies> 
```

查看 [Spring Data Release Train](https://web.archive.org/web/20220703151853/https://mvnrepository.com/artifact/org.springframework.data/spring-data-releasetrain) 、[AWS Java SDK For Amazon dynamo db](https://web.archive.org/web/20220703151853/https://mvnrepository.com/artifact/com.amazonaws/aws-java-sdk-dynamodb)和 [Spring Data DynamoDB](https://web.archive.org/web/20220703151853/https://mvnrepository.com/artifact/com.github.derjust/spring-data-dynamodb) 的最新版本。

## **4。配置**

接下来，让我们在`application.properties`文件中定义以下属性:

```
amazon.dynamodb.endpoint=http://localhost:8000/
amazon.aws.accesskey=key
amazon.aws.secretkey=key2 
```

上面列出的访问密钥和秘密密钥只是本地配置的任意值。当访问 DynamoDB 的本地实例时，这些字段需要由一些值填充，但实际验证时并不需要。

这些属性将被动态地从**Spring 配置**中的`application.properties`文件中提取出来:

```
@Configuration
@EnableDynamoDBRepositories
  (basePackages = "com.baeldung.spring.data.dynamodb.repositories")
public class DynamoDBConfig {

    @Value("${amazon.dynamodb.endpoint}")
    private String amazonDynamoDBEndpoint;

    @Value("${amazon.aws.accesskey}")
    private String amazonAWSAccessKey;

    @Value("${amazon.aws.secretkey}")
    private String amazonAWSSecretKey;

    @Bean
    public AmazonDynamoDB amazonDynamoDB() {
        AmazonDynamoDB amazonDynamoDB 
          = new AmazonDynamoDBClient(amazonAWSCredentials());

        if (!StringUtils.isEmpty(amazonDynamoDBEndpoint)) {
            amazonDynamoDB.setEndpoint(amazonDynamoDBEndpoint);
        }

        return amazonDynamoDB;
    }

    @Bean
    public AWSCredentials amazonAWSCredentials() {
        return new BasicAWSCredentials(
          amazonAWSAccessKey, amazonAWSSecretKey);
    }
}
```

## **5。数据模型**

现在让我们创建一个 POJO 模型来表示 DynamoDB 中存储的数据。

这个 POJO 将使用类似于 Hibernate 中使用的注释来定义表名、属性、键和表的其他方面。

### **5.1。数据模型属性**

下面的类`ProductInfo`表示一个包含 3 个属性的项目表:

1.  身份证明
2.  厂商建议零售价
3.  费用

### 5.2。Java 数据模型类

让我们在数据模型文件夹中创建一个名为`ProductInfo.java`的文件:

```
@DynamoDBTable(tableName = "ProductInfo")
public class ProductInfo {
    private String id;
    private String msrp;
    private String cost;

    @DynamoDBHashKey
    @DynamoDBAutoGeneratedKey
    public String getId() {
        return id;
    }

    @DynamoDBAttribute
    public String getMsrp() {
        return msrp;
    }

    @DynamoDBAttribute
    public String getCost() {
        return cost;
    }

    // standard setters/constructors
} 
```

## **6。CRUD 储存库**

接下来，我们需要创建一个`ProductRepository`接口来定义我们想要构建的 CRUD 功能。用于从 DynamoDB 读取和持久存储数据的存储库将实现这个接口:

```
@EnableScan
public interface ProductInfoRepository extends 
  CrudRepository<ProductInfo, String> {

    Optional<ProductInfo> findById(String id);
} 
```

## **7。集成测试**

接下来，让我们创建一个集成测试来确保我们可以成功地连接到 DynamoDB 的本地实例:

```
@RunWith(SpringJUnit4ClassRunner.class)
@SpringBootTest(classes = Application.class)
@WebAppConfiguration
@ActiveProfiles("local")
@TestPropertySource(properties = { 
  "amazon.dynamodb.endpoint=http://localhost:8000/", 
  "amazon.aws.accesskey=test1", 
  "amazon.aws.secretkey=test231" })
public class ProductInfoRepositoryIntegrationTest {

    private DynamoDBMapper dynamoDBMapper;

    @Autowired
    private AmazonDynamoDB amazonDynamoDB;

    @Autowired
    ProductInfoRepository repository;

    private static final String EXPECTED_COST = "20";
    private static final String EXPECTED_PRICE = "50";

    @Before
    public void setup() throws Exception {
        dynamoDBMapper = new DynamoDBMapper(amazonDynamoDB);

        CreateTableRequest tableRequest = dynamoDBMapper
          .generateCreateTableRequest(ProductInfo.class);
        tableRequest.setProvisionedThroughput(
          new ProvisionedThroughput(1L, 1L));
        amazonDynamoDB.createTable(tableRequest);

        //...

        dynamoDBMapper.batchDelete(
          (List<ProductInfo>)repository.findAll());
    }

    @Test
    public void givenItemWithExpectedCost_whenRunFindAll_thenItemIsFound() { 
        ProductInfo productInfo = new ProductInfo(EXPECTED_COST, EXPECTED_PRICE);
        repository.save(productInfo); 
        List<ProductInfo> result = (List<ProductInfo>) repository.findAll();

        assertThat(result.size(), is(greaterThan(0)));
        assertThat(result.get(0).getCost(), is(equalTo(EXPECTED_COST))); 
    }
} 
```

## **8。结论**

我们完成了——我们现在可以从 Spring Boot 应用程序连接到 DynamoDB 了。

当然，在本地完成测试后，我们应该能够在 AWS 上透明地使用 DynamoDB 的一个活动实例，并且只需对配置进行少量修改就可以运行部署的代码。

与往常一样，本文中使用的示例可以在 GitHub 上作为示例项目[获得。](https://web.archive.org/web/20220703151853/https://github.com/eugenp/tutorials/tree/master/persistence-modules/spring-data-dynamodb)