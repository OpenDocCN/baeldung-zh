# 使用带注释的@的 Lombok

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/lombok-with-annotations>

## 1.介绍

Lombok 是一个帮助我们在编写 Java 应用程序时显著减少样板代码的库。

在本教程中，我们将看到如何使用这个库来复制只改变一个属性的不可变对象。

## 2.使用

当处理不可变对象时，设计上不允许 setters，我们可能需要一个与当前对象相似的对象，但是只有一个属性不同。这可以通过使用 Lombok 的`@With`注释来实现:

[PRE0]

上面的注释生成了以下内容:

[PRE1]

然后，我们可以使用上面生成的方法来创建原始对象的变异副本:

[PRE2]

此外，我们可以选择**注释整个类，这将为所有属性**生成`withX() `方法。

## 3.要求

为了正确使用`@With`注释，**我们需要提供一个全参数构造函数**。正如我们从上面的例子中看到的，生成的方法需要它来创建原始对象的克隆。

我们可以使用 Lombok 自己的`@AllArgsConstructor`或`@Value`注释来满足这个需求。或者，我们也可以手动提供这个构造函数，同时确保类中非静态属性的顺序与构造函数的顺序相匹配。

我们应该记住，如果用在静态字段上， **`@With`注释什么也不做。这是因为静态属性不被认为是对象状态的一部分。此外，对于以`$`符号**开头的字段，Lombok 跳过了**方法的生成。**

## 4.高级用法

让我们研究一下使用这个注释时的一些高级场景。

### 4.1.抽象类

我们可以在抽象类的字段上使用`@With`注释:

[PRE3]

然而，**我们将需要为生成的`withInspected() `方法**提供一个实现。这是因为 Lombok 不知道我们的抽象类的具体实现来创建它的克隆:

[PRE4]

### 4.2.命名规格

如上所述，Lombok 将跳过以`$`符号开头的字段。但是，如果字段以一个字符开头，那么它就是标题大小写的，最后，`with`作为前缀加到生成的方法上。

或者，如果字段以下划线开头，那么`with`只是作为生成方法的前缀:

[PRE5]

根据上面的代码，我们看到只有前两个变量有为它们生成的`withX() `方法:

[PRE6]

### 4.3.方法生成的例外

我们应该注意，除了以`$`符号开始的字段之外， **Lombok 不会生成一个`withX() `方法，如果它已经存在于我们的类**中:

[PRE7]

在上面的场景中，不会生成新的`withSku()`方法。

此外，在下面的场景中，Lombok **跳过** **方法生成:**

[PRE8]

我们可以注意到上面的`withSKU()` 方法的不同命名。

基本上，如果出现以下情况，Lombok 将跳过方法生成:

*   存在与生成的方法名相同的方法(忽略大小写)
*   现有方法与生成的方法具有相同数量的参数(包括 var-args)

### 4.4.对生成的方法进行无效验证

与其他 Lombok 注释类似，我们可以对使用`@With`注释生成的方法进行`null`检查:

[PRE9]

Lombok 将为我们生成以下代码以及所需的`null`检查:

[PRE10]

## 5.结论

在本文中，我们已经看到了如何使用 Lombok 的`@With`注释来生成特定对象的克隆，其中一个字段发生了变化。

我们还了解了这个方法生成实际上是如何以及何时工作的，以及如何用额外的验证(比如`null`检查)来扩充它。

与往常一样，GitHub 上的[提供了代码示例。](https://web.archive.org/web/20221126224530/https://github.com/eugenp/tutorials/tree/master/lombok-modules/lombok-2)