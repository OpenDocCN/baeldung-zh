# Unirest 指南

> 原文：<https://web.archive.org/web/20220930061024/https://www.baeldung.com/unirest>

## **1。概述**

Unirest 是 Mashape 的一个轻量级 HTTP 客户端库。除了 Java，Node.js 也可以使用它。Net，Python，Ruby 等。

在我们开始之前，请注意我们将使用 [mocky.io](https://web.archive.org/web/20220626205115/https://www.mocky.io/) 来处理所有的 HTTP 请求。

## **2。Maven 设置**

首先，让我们添加必要的依赖项:

[PRE0]

点击查看最新版本[。](https://web.archive.org/web/20220626205115/https://search.maven.org/classic/#search%7Cga%7C1%7Cg%3A%22com.mashape.unirest%22%2C%20a%3A%22unirest-java%22)

## **3。简单请求**

让我们发送一个简单的 HTTP 请求，以理解框架的语义:

[PRE1]

请注意，该 API 流畅、高效且非常易于阅读。

我们用`header()` 和`fields()` API 传递头和参数。

并且请求在`asJson()`方法调用中被调用；我们这里也有其他选项，比如`asBinary(), asString()`和`asObject().`

为了传递多个标题或字段，我们可以创建一个映射，并将它们分别传递给`.headers(Map<String, Object> headers)`和`.fields(Map<String, String> fields)`:

[PRE2]

### **3.1。传递查询参数**

为了将数据作为查询`String,`传递，我们将使用`queryString()` 方法:

[PRE3]

### **3.2。使用路径参数**

对于传递任何 URL 参数，我们可以使用`routeParam()`方法:

[PRE4]

参数占位符名称必须与方法的第一个参数相同。

### **3.3。正文为**的请求

如果我们的请求需要一个 string/JSON 主体，我们使用`body()`方法传递它:

[PRE5]

### **3.4。对象映射器**

为了在请求中使用`asObject()`或`body()`，我们需要定义我们的对象映射器。为了简单起见，我们将使用 Jackson 对象映射器。

让我们首先将以下依赖项添加到`pom.xml`:

[PRE6]

在 Maven Central 上始终使用最新版本的[。](https://web.archive.org/web/20220626205115/https://search.maven.org/classic/#search%7Cgav%7C1%7Cg%3A%22com.fasterxml.jackson.core%22%20AND%20a%3A%22jackson-databind%22)

现在让我们配置我们的映射器:

[PRE7]

注意`setObjectMapper()`应该只被调用一次，用于设置映射器；一旦设置了映射器实例，它将用于所有请求和响应。

现在让我们使用一个定制的`Article`对象来测试新功能:

[PRE8]

## **4。请求方法**

与任何 HTTP 客户端类似，该框架为每个 HTTP 动词提供了单独的方法:

帖子:

[PRE9]

放:

[PRE10]

获取:

[PRE11]

删除:

[PRE12]

补丁:

[PRE13]

选项:

[PRE14]

## **5。响应方法**

一旦我们得到响应，让我们检查状态代码和状态消息:

[PRE15]

提取邮件头:

[PRE16]

获取响应正文:

[PRE17]

注意，`getRawBody(),` 返回未解析的响应体的流，而`getBody()`使用前面部分定义的对象映射器返回已解析的体。

## **6。处理异步请求**

Unirest 还能够处理异步请求——使用`java.util.concurrent.Future` 和回调方法:

[PRE18]

`com.mashape.unirest.http.async.Callback<T>`接口提供了三种方法，`failed()`、 `cancelled()`和 `completed().`

根据响应重写方法以执行必要的操作。

## 7 .**。文件上传**

要上传或发送文件作为请求的一部分，将一个`java.io.File` 对象作为一个名为 file:

[PRE19]

我们也可以使用`ByteStream:`

[PRE20]

或者直接使用输入流，在`fields()` 方法中添加`ContentType.APPLICATION_OCTET_STREAM` 作为第二个参数:

[PRE21]

## **8。Unirest 配置**

该框架还支持 HTTP 客户端的典型配置，如连接池、超时、全局头等。

让我们设置每条路由的连接数和最大连接数:

[PRE22]

配置连接和套接字超时:

[PRE23]

请注意，时间值以毫秒为单位。

现在让我们为所有请求设置 HTTP 头:

[PRE24]

我们可以随时清除全局标题:

[PRE25]

在某些时候，我们可能需要通过代理服务器发出请求:

[PRE26]

需要注意的一个重要方面是优雅地关闭或退出应用程序。Unirest 产生一个后台事件循环来处理操作，我们需要在退出应用程序之前关闭该循环:

[PRE27]

## **9。结论**

在本教程中，我们主要关注轻量级 HTTP 客户端框架——Unirest。我们使用了一些简单的例子，既有同步模式，也有异步模式。

最后，我们还使用了一些高级配置，如连接池、代理设置等。

和往常一样，源代码可以在 GitHub 的[上找到。](https://web.archive.org/web/20220626205115/https://github.com/eugenp/tutorials/tree/master/libraries-http)